define("page",["ThreeCanvas"],(function(t,i,e){var n=t("./ThreeCanvas");Particle3D=function(t){n.Particle.call(this,t),this.velocity=new n.Vector3(0,-8,0),this.velocity.rotateX(o(-45,45)),this.velocity.rotateY(o(0,360)),this.gravity=new n.Vector3(0,0,0),this.drag=1},Particle3D.prototype=new n.Particle,Particle3D.prototype.constructor=Particle3D,Particle3D.prototype.updatePhysics=function(){this.velocity.multiplyScalar(this.drag),this.velocity.addSelf(this.gravity),this.position.addSelf(this.velocity)};var r=Math.PI/180;function o(t,i){return Math.random()*(i-t)+t}n.Vector3.prototype.rotateY=function(t){cosRY=Math.cos(t*r),sinRY=Math.sin(t*r);var i=this.z,e=this.x;this.x=e*cosRY+i*sinRY,this.z=e*-sinRY+i*cosRY},n.Vector3.prototype.rotateX=function(t){cosRY=Math.cos(t*r),sinRY=Math.sin(t*r);var i=this.z,e=this.y;this.y=e*cosRY+i*sinRY,this.z=e*-sinRY+i*cosRY},n.Vector3.prototype.rotateZ=function(t){cosRY=Math.cos(t*r),sinRY=Math.sin(t*r);var i=this.x,e=this.y;this.y=e*cosRY+i*sinRY,this.x=e*-sinRY+i*cosRY},e.exports=Particle3D})),define("ThreeCanvas",[],(function(t,i,e){var n=n||{};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),n.Color=function(t){return void 0!==t&&this.setHex(t),this},n.Color.prototype={constructor:n.Color,r:1,g:1,b:1,copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t){return this.r=t.r*t.r,this.g=t.g*t.g,this.b=t.b*t.b,this},copyLinearToGamma:function(t){return this.r=Math.sqrt(t.r),this.g=Math.sqrt(t.g),this.b=Math.sqrt(t.b),this},setRGB:function(t,i,e){return this.r=t,this.g=i,this.b=e,this},setHSV:function(t,i,e){var n,r,o;if(0===e)this.r=this.g=this.b=0;else switch(n=Math.floor(6*t),r=6*t-n,t=e*(1-i),o=e*(1-i*r),i=e*(1-i*(1-r)),n){case 1:this.r=o,this.g=e,this.b=t;break;case 2:this.r=t,this.g=e,this.b=i;break;case 3:this.r=t,this.g=o,this.b=e;break;case 4:this.r=i,this.g=t,this.b=e;break;case 5:this.r=e,this.g=t,this.b=o;break;case 6:case 0:this.r=e,this.g=i,this.b=t}return this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},getHex:function(){return~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new n.Color).setRGB(this.r,this.g,this.b)}},n.Vector2=function(t,i){this.x=t||0,this.y=i||0},n.Vector2.prototype={constructor:n.Vector2,set:function(t,i){return this.x=t,this.y=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clone:function(){return new n.Vector2(this.x,this.y)},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x;return i*i+(t=this.y-t.y)*t},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t){return t.x===this.x&&t.y===this.y}},n.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},n.Vector3.prototype={constructor:n.Vector3,set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},clone:function(){return new n.Vector3(this.x,this.y,this.z)},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideSelf:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t,this.z/=t):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},cross:function(t,i){return this.x=t.y*i.z-t.z*i.y,this.y=t.z*i.x-t.x*i.z,this.z=t.x*i.y-t.y*i.x,this},crossSelf:function(t){var i=this.x,e=this.y,n=this.z;return this.x=e*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-e*t.x,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){return(new n.Vector3).sub(this,t).lengthSq()},setPositionFromMatrix:function(t){this.x=t.n14,this.y=t.n24,this.z=t.n34},setRotationFromMatrix:function(t){var i=Math.cos(this.y);this.y=Math.asin(t.n13),Math.abs(i)>1e-5?(this.x=Math.atan2(-t.n23/i,t.n33/i),this.z=Math.atan2(-t.n12/i,t.n11/i)):(this.x=0,this.z=Math.atan2(t.n21,t.n22))},isZero:function(){return this.lengthSq()<1e-4}},n.Vector4=function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==n?n:1},n.Vector4.prototype={constructor:n.Vector4,set:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1},clone:function(){return new n.Vector4(this.x,this.y,this.z,this.w)},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},lerpSelf:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}},n.Ray=function(t,i){function e(t,i,e){return b.sub(e,t),(u=b.dot(i))<=0?null:(d=S.add(t,z.copy(i).multiplyScalar(u)),e.distanceTo(d))}function r(t,i,e,n){return b.sub(n,i),S.sub(e,i),z.sub(t,i),f=b.dot(b),m=b.dot(S),y=b.dot(z),x=S.dot(S),g=S.dot(z),M=(f*g-m*y)*(v=1/(f*x-m*m)),(w=(x*y-m*g)*v)>=0&&M>=0&&w+M<1}this.origin=t||new n.Vector3,this.direction=i||new n.Vector3,this.intersectScene=function(t){return this.intersectObjects(t.children)},this.intersectObjects=function(t){var i,e,n=[];for(i=0,e=t.length;i<e;i++)Array.prototype.push.apply(n,this.intersectObject(t[i]));return n.sort((function(t,i){return t.distance-i.distance})),n};var o=new n.Vector3,s=new n.Vector3,a=new n.Vector3,h=new n.Vector3,c=(t=new n.Vector3,i=new n.Vector3,new n.Vector3),l=new n.Vector3,p=new n.Vector3;this.intersectObject=function(u){for(var d,f=[],m=0,y=u.children.length;m<y;m++)Array.prototype.push.apply(f,this.intersectObject(u.children[m]));if(u instanceof n.Particle){if(null===(m=e(this.origin,this.direction,u.matrixWorld.getPosition()))||m>u.scale.x)return[];d={distance:m,point:u.position,face:null,object:u},f.push(d)}else if(u instanceof n.Mesh){if(null===(m=e(this.origin,this.direction,u.matrixWorld.getPosition()))||m>u.geometry.boundingSphere.radius*Math.max(u.scale.x,Math.max(u.scale.y,u.scale.z)))return f;var x,g,v=u.geometry,w=v.vertices;for(u.matrixRotationWorld.extractRotation(u.matrixWorld),m=0,y=v.faces.length;m<y;m++)d=v.faces[m],t.copy(this.origin),i.copy(this.direction),g=u.matrixWorld,(x=(c=g.multiplyVector3(c.copy(d.centroid)).subSelf(t)).dot(i))<=0||(o=g.multiplyVector3(o.copy(w[d.a].position)),s=g.multiplyVector3(s.copy(w[d.b].position)),a=g.multiplyVector3(a.copy(w[d.c].position)),d instanceof n.Face4&&(h=g.multiplyVector3(h.copy(w[d.d].position))),l=u.matrixRotationWorld.multiplyVector3(l.copy(d.normal)),x=i.dot(l),!u.doubleSided&&!(u.flipSided?x>0:x<0))||(x=l.dot(c.sub(o,t))/x,p.add(t,i.multiplyScalar(x)),d instanceof n.Face3?r(p,o,s,a)&&(d={distance:t.distanceTo(p),point:p.clone(),face:d,object:u},f.push(d)):d instanceof n.Face4&&(r(p,o,s,h)||r(p,s,a,h))&&(d={distance:t.distanceTo(p),point:p.clone(),face:d,object:u},f.push(d)))}return f};var u,d,f,m,y,x,g,v,w,M,b=new n.Vector3,S=new n.Vector3,z=new n.Vector3},n.Rectangle=function(){function t(){o=n-i,s=r-e}var i,e,n,r,o,s,a=!0;this.getX=function(){return i},this.getY=function(){return e},this.getWidth=function(){return o},this.getHeight=function(){return s},this.getLeft=function(){return i},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return r},this.set=function(o,s,h,c){a=!1,i=o,e=s,n=h,r=c,t()},this.addPoint=function(o,s){a?(a=!1,i=o,e=s,n=o,r=s):(i=i<o?i:o,e=e<s?e:s,n=n>o?n:o,r=r>s?r:s),t()},this.add3Points=function(o,s,h,c,l,p){a?(a=!1,i=o<h?o<l?o:l:h<l?h:l,e=s<c?s<p?s:p:c<p?c:p,n=o>h?o>l?o:l:h>l?h:l,r=s>c?s>p?s:p:c>p?c:p):(i=o<h?o<l?o<i?o:i:l<i?l:i:h<l?h<i?h:i:l<i?l:i,e=s<c?s<p?s<e?s:e:p<e?p:e:c<p?c<e?c:e:p<e?p:e,n=o>h?o>l?o>n?o:n:l>n?l:n:h>l?h>n?h:n:l>n?l:n,r=s>c?s>p?s>r?s:r:p>r?p:r:c>p?c>r?c:r:p>r?p:r),t()},this.addRectangle=function(o){a?(a=!1,i=o.getLeft(),e=o.getTop(),n=o.getRight(),r=o.getBottom()):(i=i<o.getLeft()?i:o.getLeft(),e=e<o.getTop()?e:o.getTop(),n=n>o.getRight()?n:o.getRight(),r=r>o.getBottom()?r:o.getBottom()),t()},this.inflate=function(o){i-=o,e-=o,n+=o,r+=o,t()},this.minSelf=function(o){i=i>o.getLeft()?i:o.getLeft(),e=e>o.getTop()?e:o.getTop(),n=n<o.getRight()?n:o.getRight(),r=r<o.getBottom()?r:o.getBottom(),t()},this.intersects=function(t){return Math.min(n,t.getRight())-Math.max(i,t.getLeft())>=0&&Math.min(r,t.getBottom())-Math.max(e,t.getTop())>=0},this.empty=function(){a=!0,r=n=e=i=0,t()},this.isEmpty=function(){return a}},n.Math={clamp:function(t,i,e){return t<i?i:t>e?e:t},clampBottom:function(t,i){return t<i?i:t},mapLinear:function(t,i,e,n,r){return n+(t-i)*(r-n)/(e-i)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}},n.Matrix3=function(){this.m=[]},n.Matrix3.prototype={constructor:n.Matrix3,transpose:function(){var t,i=this.m;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},transposeIntoArray:function(t){var i=this.m;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}},n.Matrix4=function(t,i,e,r,o,s,a,h,c,l,p,u,d,f,m,y){this.set(void 0!==t?t:1,i||0,e||0,r||0,o||0,void 0!==s?s:1,a||0,h||0,c||0,l||0,void 0!==p?p:1,u||0,d||0,f||0,m||0,void 0!==y?y:1),this.flat=Array(16),this.m33=new n.Matrix3},n.Matrix4.prototype={constructor:n.Matrix4,set:function(t,i,e,n,r,o,s,a,h,c,l,p,u,d,f,m){return this.n11=t,this.n12=i,this.n13=e,this.n14=n,this.n21=r,this.n22=o,this.n23=s,this.n24=a,this.n31=h,this.n32=c,this.n33=l,this.n34=p,this.n41=u,this.n42=d,this.n43=f,this.n44=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.set(t.n11,t.n12,t.n13,t.n14,t.n21,t.n22,t.n23,t.n24,t.n31,t.n32,t.n33,t.n34,t.n41,t.n42,t.n43,t.n44),this},lookAt:function(t,i,e){var r=n.Matrix4.__v1,o=n.Matrix4.__v2,s=n.Matrix4.__v3;return s.sub(t,i).normalize(),0===s.length()&&(s.z=1),r.cross(e,s).normalize(),0===r.length()&&(s.x+=1e-4,r.cross(e,s).normalize()),o.cross(s,r).normalize(),this.n11=r.x,this.n12=o.x,this.n13=s.x,this.n21=r.y,this.n22=o.y,this.n23=s.y,this.n31=r.z,this.n32=o.z,this.n33=s.z,this},multiply:function(t,i){var e=t.n11,n=t.n12,r=t.n13,o=t.n14,s=t.n21,a=t.n22,h=t.n23,c=t.n24,l=t.n31,p=t.n32,u=t.n33,d=t.n34,f=t.n41,m=t.n42,y=t.n43,x=t.n44,g=i.n11,v=i.n12,w=i.n13,M=i.n14,b=i.n21,S=i.n22,z=i.n23,V=i.n24,C=i.n31,L=i.n32,R=i.n33,j=i.n34,W=i.n41,T=i.n42,P=i.n43,B=i.n44;return this.n11=e*g+n*b+r*C+o*W,this.n12=e*v+n*S+r*L+o*T,this.n13=e*w+n*z+r*R+o*P,this.n14=e*M+n*V+r*j+o*B,this.n21=s*g+a*b+h*C+c*W,this.n22=s*v+a*S+h*L+c*T,this.n23=s*w+a*z+h*R+c*P,this.n24=s*M+a*V+h*j+c*B,this.n31=l*g+p*b+u*C+d*W,this.n32=l*v+p*S+u*L+d*T,this.n33=l*w+p*z+u*R+d*P,this.n34=l*M+p*V+u*j+d*B,this.n41=f*g+m*b+y*C+x*W,this.n42=f*v+m*S+y*L+x*T,this.n43=f*w+m*z+y*R+x*P,this.n44=f*M+m*V+y*j+x*B,this},multiplySelf:function(t){return this.multiply(this,t)},multiplyToArray:function(t,i,e){return this.multiply(t,i),e[0]=this.n11,e[1]=this.n21,e[2]=this.n31,e[3]=this.n41,e[4]=this.n12,e[5]=this.n22,e[6]=this.n32,e[7]=this.n42,e[8]=this.n13,e[9]=this.n23,e[10]=this.n33,e[11]=this.n43,e[12]=this.n14,e[13]=this.n24,e[14]=this.n34,e[15]=this.n44,this},multiplyScalar:function(t){return this.n11*=t,this.n12*=t,this.n13*=t,this.n14*=t,this.n21*=t,this.n22*=t,this.n23*=t,this.n24*=t,this.n31*=t,this.n32*=t,this.n33*=t,this.n34*=t,this.n41*=t,this.n42*=t,this.n43*=t,this.n44*=t,this},multiplyVector3:function(t){var i=t.x,e=t.y,n=t.z,r=1/(this.n41*i+this.n42*e+this.n43*n+this.n44);return t.x=(this.n11*i+this.n12*e+this.n13*n+this.n14)*r,t.y=(this.n21*i+this.n22*e+this.n23*n+this.n24)*r,t.z=(this.n31*i+this.n32*e+this.n33*n+this.n34)*r,t},multiplyVector4:function(t){var i=t.x,e=t.y,n=t.z,r=t.w;return t.x=this.n11*i+this.n12*e+this.n13*n+this.n14*r,t.y=this.n21*i+this.n22*e+this.n23*n+this.n24*r,t.z=this.n31*i+this.n32*e+this.n33*n+this.n34*r,t.w=this.n41*i+this.n42*e+this.n43*n+this.n44*r,t},rotateAxis:function(t){var i=t.x,e=t.y,n=t.z;return t.x=i*this.n11+e*this.n12+n*this.n13,t.y=i*this.n21+e*this.n22+n*this.n23,t.z=i*this.n31+e*this.n32+n*this.n33,t.normalize(),t},crossVector:function(t){var i=new n.Vector4;return i.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w,i.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w,i.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w,i.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1,i},determinant:function(){var t=this.n11,i=this.n12,e=this.n13,n=this.n14,r=this.n21,o=this.n22,s=this.n23,a=this.n24,h=this.n31,c=this.n32,l=this.n33,p=this.n34,u=this.n41,d=this.n42,f=this.n43,m=this.n44;return n*s*c*u-e*a*c*u-n*o*l*u+i*a*l*u+e*o*p*u-i*s*p*u-n*s*h*d+e*a*h*d+n*r*l*d-t*a*l*d-e*r*p*d+t*s*p*d+n*o*h*f-i*a*h*f-n*r*c*f+t*a*c*f+i*r*p*f-t*o*p*f-e*o*h*m+i*s*h*m+e*r*c*m-t*s*c*m-i*r*l*m+t*o*l*m},transpose:function(){var t;return t=this.n21,this.n21=this.n12,this.n12=t,t=this.n31,this.n31=this.n13,this.n13=t,t=this.n32,this.n32=this.n23,this.n23=t,t=this.n41,this.n41=this.n14,this.n14=t,t=this.n42,this.n42=this.n24,this.n24=t,t=this.n43,this.n43=this.n34,this.n43=t,this},clone:function(){var t=new n.Matrix4;return t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(t){return t[0]=this.n11,t[1]=this.n21,t[2]=this.n31,t[3]=this.n41,t[4]=this.n12,t[5]=this.n22,t[6]=this.n32,t[7]=this.n42,t[8]=this.n13,t[9]=this.n23,t[10]=this.n33,t[11]=this.n43,t[12]=this.n14,t[13]=this.n24,t[14]=this.n34,t[15]=this.n44,t},flattenToArrayOffset:function(t,i){return t[i]=this.n11,t[i+1]=this.n21,t[i+2]=this.n31,t[i+3]=this.n41,t[i+4]=this.n12,t[i+5]=this.n22,t[i+6]=this.n32,t[i+7]=this.n42,t[i+8]=this.n13,t[i+9]=this.n23,t[i+10]=this.n33,t[i+11]=this.n43,t[i+12]=this.n14,t[i+13]=this.n24,t[i+14]=this.n34,t[i+15]=this.n44,t},setTranslation:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this},setScale:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this},setRotationX:function(t){var i=Math.cos(t);t=Math.sin(t);return this.set(1,0,0,0,0,i,-t,0,0,t,i,0,0,0,0,1),this},setRotationY:function(t){var i=Math.cos(t);t=Math.sin(t);return this.set(i,0,t,0,0,1,0,0,-t,0,i,0,0,0,0,1),this},setRotationZ:function(t){var i=Math.cos(t);t=Math.sin(t);return this.set(i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(t,i){var e=Math.cos(i),n=Math.sin(i),r=1-e,o=t.x,s=t.y,a=t.z,h=r*o,c=r*s;return this.set(h*o+e,h*s-n*a,h*a+n*s,0,h*s+n*a,c*s+e,c*a-n*o,0,h*a-n*s,c*a+n*o,r*a*a+e,0,0,0,0,1),this},setPosition:function(t){return this.n14=t.x,this.n24=t.y,this.n34=t.z,this},getPosition:function(){return n.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return n.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return n.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return n.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(t){var i=t.n11,e=t.n12,n=t.n13,r=t.n14,o=t.n21,s=t.n22,a=t.n23,h=t.n24,c=t.n31,l=t.n32,p=t.n33,u=t.n34,d=t.n41,f=t.n42,m=t.n43,y=t.n44;return this.n11=a*u*f-h*p*f+h*l*m-s*u*m-a*l*y+s*p*y,this.n12=r*p*f-n*u*f-r*l*m+e*u*m+n*l*y-e*p*y,this.n13=n*h*f-r*a*f+r*s*m-e*h*m-n*s*y+e*a*y,this.n14=r*a*l-n*h*l-r*s*p+e*h*p+n*s*u-e*a*u,this.n21=h*p*d-a*u*d-h*c*m+o*u*m+a*c*y-o*p*y,this.n22=n*u*d-r*p*d+r*c*m-i*u*m-n*c*y+i*p*y,this.n23=r*a*d-n*h*d-r*o*m+i*h*m+n*o*y-i*a*y,this.n24=n*h*c-r*a*c+r*o*p-i*h*p-n*o*u+i*a*u,this.n31=s*u*d-h*l*d+h*c*f-o*u*f-s*c*y+o*l*y,this.n32=r*l*d-e*u*d-r*c*f+i*u*f+e*c*y-i*l*y,this.n33=n*h*d-r*s*d+r*o*f-i*h*f-e*o*y+i*s*y,this.n34=r*s*c-e*h*c-r*o*l+i*h*l+e*o*u-i*s*u,this.n41=a*l*d-s*p*d-a*c*f+o*p*f+s*c*m-o*l*m,this.n42=e*p*d-n*l*d+n*c*f-i*p*f-e*c*m+i*l*m,this.n43=n*s*d-e*a*d-n*o*f+i*a*f+e*o*m-i*s*m,this.n44=e*a*c-n*s*c+n*o*l-i*a*l-e*o*p+i*s*p,this.multiplyScalar(1/t.determinant()),this},setRotationFromEuler:function(t,i){var e=t.x,n=t.y,r=t.z,o=Math.cos(e),s=(e=Math.sin(e),Math.cos(n)),a=(n=Math.sin(n),Math.cos(r));r=Math.sin(r);switch(i){case"YXZ":var h=s*a,c=s*r,l=n*a,p=n*r;this.n11=h+p*e,this.n12=l*e-c,this.n13=o*n,this.n21=o*r,this.n22=o*a,this.n23=-e,this.n31=c*e-l,this.n32=p+h*e,this.n33=o*s;break;case"ZXY":h=s*a,c=s*r,l=n*a,p=n*r,this.n11=h-p*e,this.n12=-o*r,this.n13=l+c*e,this.n21=c+l*e,this.n22=o*a,this.n23=p-h*e,this.n31=-o*n,this.n32=e,this.n33=o*s;break;case"ZYX":h=o*a,c=o*r,l=e*a,p=e*r,this.n11=s*a,this.n12=l*n-c,this.n13=h*n+p,this.n21=s*r,this.n22=p*n+h,this.n23=c*n-l,this.n31=-n,this.n32=e*s,this.n33=o*s;break;case"YZX":h=o*s,c=o*n,l=e*s,p=e*n,this.n11=s*a,this.n12=p-h*r,this.n13=l*r+c,this.n21=r,this.n22=o*a,this.n23=-e*a,this.n31=-n*a,this.n32=c*r+l,this.n33=h-p*r;break;case"XZY":h=o*s,c=o*n,l=e*s,p=e*n,this.n11=s*a,this.n12=-r,this.n13=n*a,this.n21=h*r+p,this.n22=o*a,this.n23=c*r-l,this.n31=l*r-c,this.n32=e*a,this.n33=p*r+h;break;default:h=o*a,c=o*r,l=e*a,p=e*r,this.n11=s*a,this.n12=-s*r,this.n13=n,this.n21=c+l*n,this.n22=h-p*n,this.n23=-e*s,this.n31=p-h*n,this.n32=l+c*n,this.n33=o*s}return this},setRotationFromQuaternion:function(t){var i=t.x,e=t.y,n=t.z,r=t.w,o=i+i,s=e+e,a=n+n,h=(t=i*o,i*s);i*=a;var c=e*s;return e*=a,n*=a,o*=r,s*=r,r*=a,this.n11=1-(c+n),this.n12=h-r,this.n13=i+s,this.n21=h+r,this.n22=1-(t+n),this.n23=e-o,this.n31=i-s,this.n32=e+o,this.n33=1-(t+c),this},scale:function(t){var i=t.x,e=t.y;t=t.z;return this.n11*=i,this.n12*=e,this.n13*=t,this.n21*=i,this.n22*=e,this.n23*=t,this.n31*=i,this.n32*=e,this.n33*=t,this.n41*=i,this.n42*=e,this.n43*=t,this},compose:function(t,i,e){var r=n.Matrix4.__m1,o=n.Matrix4.__m2;return r.identity(),r.setRotationFromQuaternion(i),o.setScale(e.x,e.y,e.z),this.multiply(r,o),this.n14=t.x,this.n24=t.y,this.n34=t.z,this},decompose:function(t,i,e){var r=n.Matrix4.__v1,o=n.Matrix4.__v2,s=n.Matrix4.__v3;return r.set(this.n11,this.n21,this.n31),o.set(this.n12,this.n22,this.n32),s.set(this.n13,this.n23,this.n33),t=t instanceof n.Vector3?t:new n.Vector3,i=i instanceof n.Quaternion?i:new n.Quaternion,(e=e instanceof n.Vector3?e:new n.Vector3).x=r.length(),e.y=o.length(),e.z=s.length(),t.x=this.n14,t.y=this.n24,t.z=this.n34,(r=n.Matrix4.__m1).copy(this),r.n11/=e.x,r.n21/=e.x,r.n31/=e.x,r.n12/=e.y,r.n22/=e.y,r.n32/=e.y,r.n13/=e.z,r.n23/=e.z,r.n33/=e.z,i.setFromRotationMatrix(r),[t,i,e]},extractPosition:function(t){return this.n14=t.n14,this.n24=t.n24,this.n34=t.n34,this},extractRotation:function(t){var i=1/(r=n.Matrix4.__v1).set(t.n11,t.n21,t.n31).length(),e=1/r.set(t.n12,t.n22,t.n32).length(),r=1/r.set(t.n13,t.n23,t.n33).length();return this.n11=t.n11*i,this.n21=t.n21*i,this.n31=t.n31*i,this.n12=t.n12*e,this.n22=t.n22*e,this.n32=t.n32*e,this.n13=t.n13*r,this.n23=t.n23*r,this.n33=t.n33*r,this}},n.Matrix4.makeInvert3x3=function(t){var i=t.m33,e=i.m,n=t.n33*t.n22-t.n32*t.n23,r=-t.n33*t.n21+t.n31*t.n23,o=t.n32*t.n21-t.n31*t.n22,s=-t.n33*t.n12+t.n32*t.n13,a=t.n33*t.n11-t.n31*t.n13,h=-t.n32*t.n11+t.n31*t.n12,c=t.n23*t.n12-t.n22*t.n13,l=-t.n23*t.n11+t.n21*t.n13,p=t.n22*t.n11-t.n21*t.n12;return 0===(t=t.n11*n+t.n21*s+t.n31*c)&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible."),t=1/t,e[0]=t*n,e[1]=t*r,e[2]=t*o,e[3]=t*s,e[4]=t*a,e[5]=t*h,e[6]=t*c,e[7]=t*l,e[8]=t*p,i},n.Matrix4.makeFrustum=function(t,i,e,r,o,s){var a;return(a=new n.Matrix4).n11=2*o/(i-t),a.n12=0,a.n13=(i+t)/(i-t),a.n14=0,a.n21=0,a.n22=2*o/(r-e),a.n23=(r+e)/(r-e),a.n24=0,a.n31=0,a.n32=0,a.n33=-(s+o)/(s-o),a.n34=-2*s*o/(s-o),a.n41=0,a.n42=0,a.n43=-1,a.n44=0,a},n.Matrix4.makePerspective=function(t,i,e,r){var o;return o=-(t=e*Math.tan(t*Math.PI/360)),n.Matrix4.makeFrustum(o*i,t*i,o,t,e,r)},n.Matrix4.makeOrtho=function(t,i,e,r,o,s){var a,h,c,l;return h=i-t,c=e-r,l=s-o,(a=new n.Matrix4).n11=2/h,a.n12=0,a.n13=0,a.n14=-(i+t)/h,a.n21=0,a.n22=2/c,a.n23=0,a.n24=-(e+r)/c,a.n31=0,a.n32=0,a.n33=-2/l,a.n34=-(s+o)/l,a.n41=0,a.n42=0,a.n43=0,a.n44=1,a},n.Matrix4.__v1=new n.Vector3,n.Matrix4.__v2=new n.Vector3,n.Matrix4.__v3=new n.Vector3,n.Matrix4.__m1=new n.Matrix4,n.Matrix4.__m2=new n.Matrix4,n.Object3D=function(){this.name="",this.id=n.Object3DCount++,this.parent=void 0,this.children=[],this.up=new n.Vector3(0,1,0),this.position=new n.Vector3,this.rotation=new n.Vector3,this.eulerOrder="XYZ",this.scale=new n.Vector3(1,1,1),this.flipSided=this.doubleSided=this.dynamic=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.matrixRotationWorld=new n.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new n.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new n.Vector3},n.Object3D.prototype={constructor:n.Object3D,translate:function(t,i){this.matrix.rotateAxis(i),this.position.addSelf(i.multiplyScalar(t))},translateX:function(t){this.translate(t,this._vector.set(1,0,0))},translateY:function(t){this.translate(t,this._vector.set(0,1,0))},translateZ:function(t){this.translate(t,this._vector.set(0,0,1))},lookAt:function(t){this.matrix.lookAt(t,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(t){if(-1===this.children.indexOf(t)){void 0!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof n.Scene&&i.addObject(t)}},remove:function(t){var i=this.children.indexOf(t);if(-1!==i){for(t.parent=void 0,this.children.splice(i,1),i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof n.Scene&&i.removeObject(t)}},getChildByName:function(t,i){var e,n,r;for(e=0,n=this.children.length;e<n;e++){if((r=this.children[e]).name===t)return r;if(i&&void 0!==(r=r.getChildByName(t,i)))return r}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var i=0,e=this.children.length;i<e;i++)this.children[i].updateMatrixWorld(t)}},n.Object3DCount=0,n.Projector=function(){function t(){var t=y[s]=y[s]||new n.RenderableObject;return s++,t}function i(){var t=x[h]=x[h]||new n.RenderableVertex;return h++,t}function e(t,i){return i.z-t.z}function r(t,i){var e=0,n=1,r=t.z+t.w,o=i.z+i.w,s=-t.z+t.w,a=-i.z+i.w;return r>=0&&o>=0&&s>=0&&a>=0||!(r<0&&o<0||s<0&&a<0)&&(r<0?e=Math.max(e,r/(r-o)):o<0&&(n=Math.min(n,r/(r-o))),s<0?e=Math.max(e,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),!(n<e)&&(t.lerpSelf(i,e),i.lerpSelf(t,1-n),!0))}var o,s,a,h,c,l,p,u,d,f,m,y=[],x=[],g=[],v=[],w=[],M=[],b={objects:[],sprites:[],lights:[],elements:[]},S=new n.Vector3,z=new n.Vector4,V=new n.Matrix4,C=new n.Matrix4,L=[new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4],R=new n.Vector4,j=new n.Vector4;this.computeFrustum=function(t){for(L[0].set(t.n41-t.n11,t.n42-t.n12,t.n43-t.n13,t.n44-t.n14),L[1].set(t.n41+t.n11,t.n42+t.n12,t.n43+t.n13,t.n44+t.n14),L[2].set(t.n41+t.n21,t.n42+t.n22,t.n43+t.n23,t.n44+t.n24),L[3].set(t.n41-t.n21,t.n42-t.n22,t.n43-t.n23,t.n44-t.n24),L[4].set(t.n41-t.n31,t.n42-t.n32,t.n43-t.n33,t.n44-t.n34),L[5].set(t.n41+t.n31,t.n42+t.n32,t.n43+t.n33,t.n44+t.n34),t=0;t<6;t++){var i=L[t];i.divideScalar(Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z))}},this.projectVector=function(t,i){return i.matrixWorldInverse.getInverse(i.matrixWorld),V.multiply(i.projectionMatrix,i.matrixWorldInverse),V.multiplyVector3(t),t},this.unprojectVector=function(t,i){return i.projectionMatrixInverse.getInverse(i.projectionMatrix),V.multiply(i.matrixWorld,i.projectionMatrixInverse),V.multiplyVector3(t),t},this.pickingRay=function(t,i){var e;return t.z=-1,e=new n.Vector3(t.x,t.y,1),this.unprojectVector(t,i),this.unprojectVector(e,i),e.subSelf(t).normalize(),new n.Ray(t,e)},this.projectGraph=function(i,r){s=0,b.objects.length=0,b.sprites.length=0,b.lights.length=0;var a=function(i){if(!1!==i.visible){var e;if((e=i instanceof n.Mesh||i instanceof n.Line)&&!(e=!1===i.frustumCulled))t:{for(var r=i.matrixWorld,s=-i.geometry.boundingSphere.radius*Math.max(i.scale.x,Math.max(i.scale.y,i.scale.z)),h=0;h<6;h++)if((e=L[h].x*r.n14+L[h].y*r.n24+L[h].z*r.n34+L[h].w)<=s){e=!1;break t}e=!0}for(e?(V.multiplyVector3(S.copy(i.position)),(o=t()).object=i,o.z=S.z,b.objects.push(o)):i instanceof n.Sprite||i instanceof n.Particle?(V.multiplyVector3(S.copy(i.position)),(o=t()).object=i,o.z=S.z,b.sprites.push(o)):i instanceof n.Light&&b.lights.push(i),e=0,r=i.children.length;e<r;e++)a(i.children[e])}};return a(i),r&&b.objects.sort(e),b},this.projectScene=function(t,o,s){var y,S,L,W,T,P,B,O,F,A,_,D,N,k,I,U,q=o.near,Y=o.far;for(m=d=p=l=0,b.elements.length=0,void 0===o.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),t.add(o)),t.updateMatrixWorld(),o.matrixWorldInverse.getInverse(o.matrixWorld),V.multiply(o.projectionMatrix,o.matrixWorldInverse),this.computeFrustum(V),b=this.projectGraph(t,!1),t=0,y=b.objects.length;t<y;t++)if(A=(F=b.objects[t].object).matrixWorld,D=F.material,h=0,F instanceof n.Mesh){for(_=F.geometry,N=F.geometry.materials,W=_.vertices,k=_.faces,I=_.faceVertexUvs,_=F.matrixRotationWorld.extractRotation(A),S=0,L=W.length;S<L;S++)(a=i()).positionWorld.copy(W[S].position),A.multiplyVector3(a.positionWorld),a.positionScreen.copy(a.positionWorld),V.multiplyVector4(a.positionScreen),a.positionScreen.x/=a.positionScreen.w,a.positionScreen.y/=a.positionScreen.w,a.visible=a.positionScreen.z>q&&a.positionScreen.z<Y;for(W=0,S=k.length;W<S;W++){if((L=k[W])instanceof n.Face3){if(T=x[L.a],P=x[L.b],B=x[L.c],!(T.visible&&P.visible&&B.visible)||!F.doubleSided&&F.flipSided==(B.positionScreen.x-T.positionScreen.x)*(P.positionScreen.y-T.positionScreen.y)-(B.positionScreen.y-T.positionScreen.y)*(P.positionScreen.x-T.positionScreen.x)<0)continue;O=g[l]=g[l]||new n.RenderableFace3,l++,(c=O).v1.copy(T),c.v2.copy(P),c.v3.copy(B)}else if(L instanceof n.Face4){if(T=x[L.a],P=x[L.b],B=x[L.c],O=x[L.d],!(T.visible&&P.visible&&B.visible&&O.visible)||!F.doubleSided&&F.flipSided==((O.positionScreen.x-T.positionScreen.x)*(P.positionScreen.y-T.positionScreen.y)-(O.positionScreen.y-T.positionScreen.y)*(P.positionScreen.x-T.positionScreen.x)<0||(P.positionScreen.x-B.positionScreen.x)*(O.positionScreen.y-B.positionScreen.y)-(P.positionScreen.y-B.positionScreen.y)*(O.positionScreen.x-B.positionScreen.x)<0))continue;U=v[p]=v[p]||new n.RenderableFace4,p++,(c=U).v1.copy(T),c.v2.copy(P),c.v3.copy(B),c.v4.copy(O)}for(c.normalWorld.copy(L.normal),_.multiplyVector3(c.normalWorld),c.centroidWorld.copy(L.centroid),A.multiplyVector3(c.centroidWorld),c.centroidScreen.copy(c.centroidWorld),V.multiplyVector3(c.centroidScreen),T=0,P=(B=L.vertexNormals).length;T<P;T++)(O=c.vertexNormalsWorld[T]).copy(B[T]),_.multiplyVector3(O);for(T=0,P=I.length;T<P;T++)if(U=I[T][W])for(B=0,O=U.length;B<O;B++)c.uvs[T][B]=U[B];c.material=D,c.faceMaterial=null!==L.materialIndex?N[L.materialIndex]:null,c.z=c.centroidScreen.z,b.elements.push(c)}}else if(F instanceof n.Line)for(C.multiply(V,A),W=F.geometry.vertices,(T=i()).positionScreen.copy(W[0].position),C.multiplyVector4(T.positionScreen),S=1,L=W.length;S<L;S++)(T=i()).positionScreen.copy(W[S].position),C.multiplyVector4(T.positionScreen),P=x[h-2],R.copy(T.positionScreen),j.copy(P.positionScreen),r(R,j)&&(R.multiplyScalar(1/R.w),j.multiplyScalar(1/j.w),F=w[d]=w[d]||new n.RenderableLine,d++,(u=F).v1.positionScreen.copy(R),u.v2.positionScreen.copy(j),u.z=Math.max(R.z,j.z),u.material=D,b.elements.push(u));for(t=0,y=b.sprites.length;t<y;t++)A=(F=b.sprites[t].object).matrixWorld,F instanceof n.Particle&&(z.set(A.n14,A.n24,A.n34,1),V.multiplyVector4(z),z.z/=z.w,z.z>0&&z.z<1)&&(q=M[m]=M[m]||new n.RenderableParticle,m++,(f=q).x=z.x/z.w,f.y=z.y/z.w,f.z=z.z,f.rotation=F.rotation.z,f.scale.x=F.scale.x*Math.abs(f.x-(z.x+o.projectionMatrix.n11)/(z.w+o.projectionMatrix.n14)),f.scale.y=F.scale.y*Math.abs(f.y-(z.y+o.projectionMatrix.n22)/(z.w+o.projectionMatrix.n24)),f.material=F.material,b.elements.push(f));return s&&b.elements.sort(e),b}},n.Quaternion=function(t,i,e,n){this.set(t||0,i||0,e||0,void 0!==n?n:1)},n.Quaternion.prototype={constructor:n.Quaternion,set:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEuler:function(t){var i=Math.PI/360,e=t.x*i,n=t.y*i,r=t.z*i,o=(t=Math.cos(n),n=Math.sin(n),i=Math.cos(-r),r=Math.sin(-r),Math.cos(e)),s=(e=Math.sin(e),t*i),a=n*r;return this.w=s*o-a*e,this.x=s*e+a*o,this.y=n*i*o+t*r*e,this.z=t*r*o-n*i*e,this},setFromAxisAngle:function(t,i){var e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this},setFromRotationMatrix:function(t){var i=Math.pow(t.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,i+t.n11+t.n22+t.n33))/2,this.x=Math.sqrt(Math.max(0,i+t.n11-t.n22-t.n33))/2,this.y=Math.sqrt(Math.max(0,i-t.n11+t.n22-t.n33))/2,this.z=Math.sqrt(Math.max(0,i-t.n11-t.n22+t.n33))/2,this.x=t.n32-t.n23<0?-Math.abs(this.x):Math.abs(this.x),this.y=t.n13-t.n31<0?-Math.abs(this.y):Math.abs(this.y),this.z=t.n21-t.n12<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?this.w=this.z=this.y=this.x=0:(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},multiplySelf:function(t){var i=this.x,e=this.y,n=this.z,r=this.w,o=t.x,s=t.y,a=t.z;t=t.w;return this.x=i*t+r*o+e*a-n*s,this.y=e*t+r*s+n*o-i*a,this.z=n*t+r*a+i*s-e*o,this.w=r*t-i*o-e*s-n*a,this},multiply:function(t,i){return this.x=t.x*i.w+t.y*i.z-t.z*i.y+t.w*i.x,this.y=-t.x*i.z+t.y*i.w+t.z*i.x+t.w*i.y,this.z=t.x*i.y-t.y*i.x+t.z*i.w+t.w*i.z,this.w=-t.x*i.x-t.y*i.y-t.z*i.z+t.w*i.w,this},multiplyVector3:function(t,i){i||(i=t);var e=t.x,n=t.y,r=t.z,o=this.x,s=this.y,a=this.z,h=this.w,c=h*e+s*r-a*n,l=h*n+a*e-o*r,p=h*r+o*n-s*e;e=-o*e-s*n-a*r;return i.x=c*h+e*-o+l*-a-p*-s,i.y=l*h+e*-s+p*-o-c*-a,i.z=p*h+e*-a+c*-s-l*-o,i}},n.Quaternion.slerp=function(t,i,e,n){if((o=t.w*i.w+t.x*i.x+t.y*i.y+t.z*i.z)<0?(e.w=-i.w,e.x=-i.x,e.y=-i.y,e.z=-i.z,o=-o):e.copy(i),Math.abs(o)>=1)return e.w=t.w,e.x=t.x,e.y=t.y,e.z=t.z,e;var r=Math.acos(o),o=Math.sqrt(1-o*o);return Math.abs(o)<.001?(e.w=.5*(t.w+i.w),e.x=.5*(t.x+i.x),e.y=.5*(t.y+i.y),e.z=.5*(t.z+i.z),e):(i=Math.sin((1-n)*r)/o,n=Math.sin(n*r)/o,e.w=t.w*i+e.w*n,e.x=t.x*i+e.x*n,e.y=t.y*i+e.y*n,e.z=t.z*i+e.z*n,e)},n.Vertex=function(t){this.position=t||new n.Vector3},n.Face3=function(t,i,e,r,o,s){this.a=t,this.b=i,this.c=e,this.normal=r instanceof n.Vector3?r:new n.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=o instanceof n.Color?o:new n.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=s,this.centroid=new n.Vector3},n.Face4=function(t,i,e,r,o,s,a){this.a=t,this.b=i,this.c=e,this.d=r,this.normal=o instanceof n.Vector3?o:new n.Vector3,this.vertexNormals=o instanceof Array?o:[],this.color=s instanceof n.Color?s:new n.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=a,this.centroid=new n.Vector3},n.UV=function(t,i){this.u=t||0,this.v=i||0},n.UV.prototype={constructor:n.UV,set:function(t,i){return this.u=t,this.v=i,this},copy:function(t){return this.u=t.u,this.v=t.v,this},clone:function(){return new n.UV(this.u,this.v)}},n.Geometry=function(){this.id=n.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},n.Geometry.prototype={constructor:n.Geometry,applyMatrix:function(t){var i=new n.Matrix4;i.extractRotation(t,new n.Vector3(1,1,1));for(var e=0,r=this.vertices.length;e<r;e++)t.multiplyVector3(this.vertices[e].position);for(e=0,r=this.faces.length;e<r;e++){var o=this.faces[e];i.multiplyVector3(o.normal);for(var s=0,a=o.vertexNormals.length;s<a;s++)i.multiplyVector3(o.vertexNormals[s]);t.multiplyVector3(o.centroid)}},computeCentroids:function(){var t,i,e;for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t]).centroid.set(0,0,0),e instanceof n.Face3?(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.divideScalar(3)):e instanceof n.Face4&&(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.addSelf(this.vertices[e.d].position),e.centroid.divideScalar(4))},computeFaceNormals:function(){var t,i,e,r,o,s,a=new n.Vector3,h=new n.Vector3;for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],r=this.vertices[e.a],o=this.vertices[e.b],s=this.vertices[e.c],a.sub(s.position,o.position),h.sub(r.position,o.position),a.crossSelf(h),a.isZero()||a.normalize(),e.normal.copy(a)},computeVertexNormals:function(){var t,i,e,r;if(void 0===this.__tmpVertices){for(r=this.__tmpVertices=Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)r[t]=new n.Vector3;for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t])instanceof n.Face3?e.vertexNormals=[new n.Vector3,new n.Vector3,new n.Vector3]:e instanceof n.Face4&&(e.vertexNormals=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3])}else for(r=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)r[t].set(0,0,0);for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t])instanceof n.Face3?(r[e.a].addSelf(e.normal),r[e.b].addSelf(e.normal),r[e.c].addSelf(e.normal)):e instanceof n.Face4&&(r[e.a].addSelf(e.normal),r[e.b].addSelf(e.normal),r[e.c].addSelf(e.normal),r[e.d].addSelf(e.normal));for(t=0,i=this.vertices.length;t<i;t++)r[t].normalize();for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t])instanceof n.Face3?(e.vertexNormals[0].copy(r[e.a]),e.vertexNormals[1].copy(r[e.b]),e.vertexNormals[2].copy(r[e.c])):e instanceof n.Face4&&(e.vertexNormals[0].copy(r[e.a]),e.vertexNormals[1].copy(r[e.b]),e.vertexNormals[2].copy(r[e.c]),e.vertexNormals[3].copy(r[e.d]))},computeTangents:function(){function t(t,i,e,n,r,o,s){h=t.vertices[i].position,c=t.vertices[e].position,l=t.vertices[n].position,p=a[r],u=a[o],d=a[s],f=c.x-h.x,m=l.x-h.x,y=c.y-h.y,x=l.y-h.y,g=c.z-h.z,v=l.z-h.z,w=u.u-p.u,M=d.u-p.u,b=u.v-p.v,S=d.v-p.v,z=1/(w*S-M*b),R.set((S*f-b*m)*z,(S*y-b*x)*z,(S*g-b*v)*z),j.set((w*m-M*f)*z,(w*x-M*y)*z,(w*v-M*g)*z),C[i].addSelf(R),C[e].addSelf(R),C[n].addSelf(R),L[i].addSelf(j),L[e].addSelf(j),L[n].addSelf(j)}var i,e,r,o,s,a,h,c,l,p,u,d,f,m,y,x,g,v,w,M,b,S,z,V,C=[],L=[],R=new n.Vector3,j=new n.Vector3,W=new n.Vector3,T=new n.Vector3,P=new n.Vector3;for(i=0,e=this.vertices.length;i<e;i++)C[i]=new n.Vector3,L[i]=new n.Vector3;for(i=0,e=this.faces.length;i<e;i++)s=this.faces[i],a=this.faceVertexUvs[0][i],s instanceof n.Face3?t(this,s.a,s.b,s.c,0,1,2):s instanceof n.Face4&&(t(this,s.a,s.b,s.c,0,1,2),t(this,s.a,s.b,s.d,0,1,3));var B=["a","b","c","d"];for(i=0,e=this.faces.length;i<e;i++)for(s=this.faces[i],r=0;r<s.vertexNormals.length;r++)P.copy(s.vertexNormals[r]),o=s[B[r]],V=C[o],W.copy(V),W.subSelf(P.multiplyScalar(P.dot(V))).normalize(),T.cross(s.vertexNormals[r],V),o=(o=T.dot(L[o]))<0?-1:1,s.vertexTangents[r]=new n.Vector4(W.x,W.y,W.z,o);this.hasTangents=!0},computeBoundingBox:function(){var t;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var i=1,e=this.vertices.length;i<e;i++)(t=this.vertices[i]).position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=t.position.x:t.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=t.position.x),t.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=t.position.y:t.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=t.position.y),t.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=t.position.z:t.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=t.position.z)}},computeBoundingSphere:function(){for(var t=0,i=0,e=this.vertices.length;i<e;i++)t=Math.max(t,this.vertices[i].position.length());this.boundingSphere={radius:t}},mergeVertices:function(){var t,i,e,r={},o=[],s=[],a=Math.pow(10,4);for(i=0,e=this.vertices.length;i<e;i++)t=this.vertices[i].position,void 0===r[t=[Math.round(t.x*a),Math.round(t.y*a),Math.round(t.z*a)].join("_")]?(r[t]=i,o.push(this.vertices[i]),s[i]=o.length-1):s[i]=s[r[t]];for(i=0,e=this.faces.length;i<e;i++)(r=this.faces[i])instanceof n.Face3?(r.a=s[r.a],r.b=s[r.b],r.c=s[r.c]):r instanceof n.Face4&&(r.a=s[r.a],r.b=s[r.b],r.c=s[r.c],r.d=s[r.d]);this.vertices=o}},n.GeometryCount=0,n.Camera=function(){if(arguments.length)return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new n.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3]);n.Object3D.call(this),this.matrixWorldInverse=new n.Matrix4,this.projectionMatrix=new n.Matrix4,this.projectionMatrixInverse=new n.Matrix4},n.Camera.prototype=new n.Object3D,n.Camera.prototype.constructor=n.Camera,n.Camera.prototype.lookAt=function(t){this.matrix.lookAt(this.position,t,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},n.OrthographicCamera=function(t,i,e,r,o,s){n.Camera.call(this),this.left=t,this.right=i,this.top=e,this.bottom=r,this.near=void 0!==o?o:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},n.OrthographicCamera.prototype=new n.Camera,n.OrthographicCamera.prototype.constructor=n.OrthographicCamera,n.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=n.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)},n.PerspectiveCamera=function(t,i,e,r){n.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==i?i:1,this.near=void 0!==e?e:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype=new n.Camera,n.PerspectiveCamera.prototype.constructor=n.PerspectiveCamera,n.PerspectiveCamera.prototype.setLens=function(t,i){this.fov=2*Math.atan((void 0!==i?i:43.25)/(2*t)),this.fov*=180/Math.PI,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.setViewOffset=function(t,i,e,n,r,o){this.fullWidth=t,this.fullHeight=i,this.x=e,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(this.fov*Math.PI/360)*this.near,e=t*(r=-i),r=(t=Math.abs(t*i-e),Math.abs(i-r));this.projectionMatrix=n.Matrix4.makeFrustum(e+this.x*t/this.fullWidth,e+(this.x+this.width)*t/this.fullWidth,i-(this.y+this.height)*r/this.fullHeight,i-this.y*r/this.fullHeight,this.near,this.far)}else this.projectionMatrix=n.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},n.Light=function(t){n.Object3D.call(this),this.color=new n.Color(t)},n.Light.prototype=new n.Object3D,n.Light.prototype.constructor=n.Light,n.Light.prototype.supr=n.Object3D.prototype,n.AmbientLight=function(t){n.Light.call(this,t)},n.AmbientLight.prototype=new n.Light,n.AmbientLight.prototype.constructor=n.AmbientLight,n.DirectionalLight=function(t,i,e){n.Light.call(this,t),this.position=new n.Vector3(0,1,0),this.intensity=void 0!==i?i:1,this.distance=void 0!==e?e:0},n.DirectionalLight.prototype=new n.Light,n.DirectionalLight.prototype.constructor=n.DirectionalLight,n.PointLight=function(t,i,e){n.Light.call(this,t),this.position=new n.Vector3(0,0,0),this.intensity=void 0!==i?i:1,this.distance=void 0!==e?e:0},n.PointLight.prototype=new n.Light,n.PointLight.prototype.constructor=n.PointLight,n.Material=function(t){this.name="",this.id=n.MaterialCount++,t=t||{},this.opacity=void 0!==t.opacity?t.opacity:1,this.transparent=void 0!==t.transparent&&t.transparent,this.blending=void 0!==t.blending?t.blending:n.NormalBlending,this.depthTest=void 0===t.depthTest||t.depthTest,this.depthWrite=void 0===t.depthWrite||t.depthWrite,this.polygonOffset=void 0!==t.polygonOffset&&t.polygonOffset,this.polygonOffsetFactor=void 0!==t.polygonOffsetFactor?t.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==t.polygonOffsetUnits?t.polygonOffsetUnits:0,this.alphaTest=void 0!==t.alphaTest?t.alphaTest:0,this.overdraw=void 0!==t.overdraw&&t.overdraw},n.MaterialCount=0,n.NoShading=0,n.FlatShading=1,n.SmoothShading=2,n.NoColors=0,n.FaceColors=1,n.VertexColors=2,n.NormalBlending=0,n.AdditiveBlending=1,n.SubtractiveBlending=2,n.MultiplyBlending=3,n.AdditiveAlphaBlending=4,n.LineBasicMaterial=function(t){n.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new n.Color(t.color):new n.Color(16777215),this.linewidth=void 0!==t.linewidth?t.linewidth:1,this.linecap=void 0!==t.linecap?t.linecap:"round",this.linejoin=void 0!==t.linejoin?t.linejoin:"round",this.vertexColors=!!t.vertexColors&&t.vertexColors,this.fog=void 0===t.fog||t.fog},n.LineBasicMaterial.prototype=new n.Material,n.LineBasicMaterial.prototype.constructor=n.LineBasicMaterial,n.MeshBasicMaterial=function(t){n.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new n.Color(t.color):new n.Color(16777215),this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:n.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0===t.fog||t.fog,this.shading=void 0!==t.shading?t.shading:n.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.skinning=void 0!==t.skinning&&t.skinning,this.morphTargets=void 0!==t.morphTargets&&t.morphTargets},n.MeshBasicMaterial.prototype=new n.Material,n.MeshBasicMaterial.prototype.constructor=n.MeshBasicMaterial,n.MeshLambertMaterial=function(t){n.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new n.Color(t.color):new n.Color(16777215),this.ambient=void 0!==t.ambient?new n.Color(t.ambient):new n.Color(328965),this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:n.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0===t.fog||t.fog,this.shading=void 0!==t.shading?t.shading:n.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.skinning=void 0!==t.skinning&&t.skinning,this.morphTargets=void 0!==t.morphTargets&&t.morphTargets},n.MeshLambertMaterial.prototype=new n.Material,n.MeshLambertMaterial.prototype.constructor=n.MeshLambertMaterial,n.MeshPhongMaterial=function(t){n.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new n.Color(t.color):new n.Color(16777215),this.ambient=void 0!==t.ambient?new n.Color(t.ambient):new n.Color(328965),this.specular=void 0!==t.specular?new n.Color(t.specular):new n.Color(1118481),this.shininess=void 0!==t.shininess?t.shininess:30,this.metal=void 0!==t.metal&&t.metal,this.perPixel=void 0!==t.perPixel&&t.perPixel,this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:n.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0===t.fog||t.fog,this.shading=void 0!==t.shading?t.shading:n.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.skinning=void 0!==t.skinning&&t.skinning,this.morphTargets=void 0!==t.morphTargets&&t.morphTargets},n.MeshPhongMaterial.prototype=new n.Material,n.MeshPhongMaterial.prototype.constructor=n.MeshPhongMaterial,n.MeshDepthMaterial=function(t){n.Material.call(this,t),t=t||{},this.shading=void 0!==t.shading?t.shading:n.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1},n.MeshDepthMaterial.prototype=new n.Material,n.MeshDepthMaterial.prototype.constructor=n.MeshDepthMaterial,n.MeshNormalMaterial=function(t){n.Material.call(this,t),t=t||{},this.shading=t.shading?t.shading:n.FlatShading,this.wireframe=!!t.wireframe&&t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth?t.wireframeLinewidth:1},n.MeshNormalMaterial.prototype=new n.Material,n.MeshNormalMaterial.prototype.constructor=n.MeshNormalMaterial,n.MeshFaceMaterial=function(){},n.ParticleBasicMaterial=function(t){n.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new n.Color(t.color):new n.Color(16777215),this.map=void 0!==t.map?t.map:null,this.size=void 0!==t.size?t.size:1,this.sizeAttenuation=void 0===t.sizeAttenuation||t.sizeAttenuation,this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.fog=void 0===t.fog||t.fog},n.ParticleBasicMaterial.prototype=new n.Material,n.ParticleBasicMaterial.prototype.constructor=n.ParticleBasicMaterial,n.ParticleCanvasMaterial=function(t){n.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new n.Color(t.color):new n.Color(16777215),this.program=void 0!==t.program?t.program:function(){}},n.ParticleCanvasMaterial.prototype=new n.Material,n.ParticleCanvasMaterial.prototype.constructor=n.ParticleCanvasMaterial,n.Texture=function(t,i,e,r,o,s){this.id=n.TextureCount++,this.image=t,this.mapping=void 0!==i?i:new n.UVMapping,this.wrapS=void 0!==e?e:n.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:n.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:n.LinearFilter,this.minFilter=void 0!==s?s:n.LinearMipMapLinearFilter,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.needsUpdate=!1,this.onUpdate=null},n.Texture.prototype={constructor:n.Texture,clone:function(){var t=new n.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return t.offset.copy(this.offset),t.repeat.copy(this.repeat),t}},n.TextureCount=0,n.MultiplyOperation=0,n.MixOperation=1,n.CubeReflectionMapping=function(){},n.CubeRefractionMapping=function(){},n.LatitudeReflectionMapping=function(){},n.LatitudeRefractionMapping=function(){},n.SphericalReflectionMapping=function(){},n.SphericalRefractionMapping=function(){},n.UVMapping=function(){},n.RepeatWrapping=0,n.ClampToEdgeWrapping=1,n.MirroredRepeatWrapping=2,n.NearestFilter=3,n.NearestMipMapNearestFilter=4,n.NearestMipMapLinearFilter=5,n.LinearFilter=6,n.LinearMipMapNearestFilter=7,n.LinearMipMapLinearFilter=8,n.ByteType=9,n.UnsignedByteType=10,n.ShortType=11,n.UnsignedShortType=12,n.IntType=13,n.UnsignedIntType=14,n.FloatType=15,n.AlphaFormat=16,n.RGBFormat=17,n.RGBAFormat=18,n.LuminanceFormat=19,n.LuminanceAlphaFormat=20,n.Particle=function(t){n.Object3D.call(this),this.material=t},n.Particle.prototype=new n.Object3D,n.Particle.prototype.constructor=n.Particle,n.Line=function(t,i,e){n.Object3D.call(this),this.geometry=t,this.material=i,this.type=void 0!==e?e:n.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},n.LineStrip=0,n.LinePieces=1,n.Line.prototype=new n.Object3D,n.Line.prototype.constructor=n.Line,n.Mesh=function(t,i){if(n.Object3D.call(this),this.geometry=t,this.material=i,i instanceof Array&&(console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=i[0]),this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=t.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0;e<this.geometry.morphTargets.length;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},n.Mesh.prototype=new n.Object3D,n.Mesh.prototype.constructor=n.Mesh,n.Mesh.prototype.supr=n.Object3D.prototype,n.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)},n.Bone=function(t){n.Object3D.call(this),this.skin=t,this.skinMatrix=new n.Matrix4},n.Bone.prototype=new n.Object3D,n.Bone.prototype.constructor=n.Bone,n.Bone.prototype.supr=n.Object3D.prototype,n.Bone.prototype.update=function(t,i){this.matrixAutoUpdate&&(i|=this.updateMatrix()),(i||this.matrixWorldNeedsUpdate)&&(t?this.skinMatrix.multiply(t,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);var e,n=this.children.length;for(e=0;e<n;e++)this.children[e].update(this.skinMatrix,i)},n.Sprite=function(t){n.Object3D.call(this),this.color=void 0!==t.color?new n.Color(t.color):new n.Color(16777215),this.map=t.map instanceof n.Texture?t.map:n.ImageUtils.loadTexture(t.map),this.blending=void 0!==t.blending?t.blending:n.NormalBlending,this.useScreenCoordinates=void 0===t.useScreenCoordinates||t.useScreenCoordinates,this.mergeWith3D=void 0!==t.mergeWith3D?t.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==t.affectedByDistance?t.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==t.scaleByViewport?t.scaleByViewport:!this.affectedByDistance,this.alignment=t.alignment instanceof n.Vector2?t.alignment:n.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new n.Vector2(0,0),this.uvScale=new n.Vector2(1,1)},n.Sprite.prototype=new n.Object3D,n.Sprite.prototype.constructor=n.Sprite,n.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},n.SpriteAlignment={},n.SpriteAlignment.topLeft=new n.Vector2(1,-1),n.SpriteAlignment.topCenter=new n.Vector2(0,-1),n.SpriteAlignment.topRight=new n.Vector2(-1,-1),n.SpriteAlignment.centerLeft=new n.Vector2(1,0),n.SpriteAlignment.center=new n.Vector2(0,0),n.SpriteAlignment.centerRight=new n.Vector2(-1,0),n.SpriteAlignment.bottomLeft=new n.Vector2(1,1),n.SpriteAlignment.bottomCenter=new n.Vector2(0,1),n.SpriteAlignment.bottomRight=new n.Vector2(-1,1),n.Scene=function(){n.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.objects=[],this.lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},n.Scene.prototype=new n.Object3D,n.Scene.prototype.constructor=n.Scene,n.Scene.prototype.addObject=function(t){if(t instanceof n.Light)-1===this.lights.indexOf(t)&&this.lights.push(t);else if(!(t instanceof n.Camera||t instanceof n.Bone)&&-1===this.objects.indexOf(t)){this.objects.push(t),this.__objectsAdded.push(t);var i=this.__objectsRemoved.indexOf(t);-1!==i&&this.__objectsRemoved.splice(i,1)}for(i=0;i<t.children.length;i++)this.addObject(t.children[i])},n.Scene.prototype.removeObject=function(t){if(t instanceof n.Light){var i=this.lights.indexOf(t);-1!==i&&this.lights.splice(i,1)}else t instanceof n.Camera||-1!==(i=this.objects.indexOf(t))&&(this.objects.splice(i,1),this.__objectsRemoved.push(t),-1!==(i=this.__objectsAdded.indexOf(t))&&this.__objectsAdded.splice(i,1));for(i=0;i<t.children.length;i++)this.removeObject(t.children[i])},n.CanvasRenderer=function(t){function i(t){J!=t&&(X.globalAlpha=J=t)}function e(t){if(K!=t){switch(t){case n.NormalBlending:X.globalCompositeOperation="source-over";break;case n.AdditiveBlending:X.globalCompositeOperation="lighter";break;case n.SubtractiveBlending:X.globalCompositeOperation="darker"}K=t}}function r(t){$!=t&&(X.strokeStyle=$=t)}function o(t){tt!=t&&(X.fillStyle=tt=t)}var s,a,h,c,l,p,u,d,f,m,y,x,g,v,w,M,b,S,z,V,C,L,R,j,W,T,P,B,O,F,A,_,D,N,k,I,U,q,Y,E=this,G=new n.Projector,H=void 0!==(t=t||{}).canvas?t.canvas:document.createElement("canvas"),X=H.getContext("2d"),Z=new n.Color(0),Q=0,J=1,K=0,$=null,tt=null,it=null,et=null,nt=null,rt=new n.RenderableVertex,ot=new n.RenderableVertex,st=new n.Color,at=new n.Color,ht=new n.Color,ct=new n.Color,lt=new n.Color,pt=[],ut=[],dt=new n.Rectangle,ft=new n.Rectangle,mt=new n.Rectangle,yt=!1,xt=new n.Color,gt=new n.Color,vt=new n.Color,wt=new n.Vector3;t=16;(N=document.createElement("canvas")).width=N.height=2,(k=N.getContext("2d")).fillStyle="rgba(0,0,0,1)",k.fillRect(0,0,2,2),I=k.getImageData(0,0,2,2),U=I.data,(q=document.createElement("canvas")).width=q.height=t,(Y=q.getContext("2d")).translate(-t/2,-t/2),Y.scale(t,t),t--,this.domElement=H,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(t,i){c=t,l=i,p=Math.floor(c/2),u=Math.floor(l/2),H.width=c,H.height=l,dt.set(-p,-u,p,u),ft.set(-p,-u,p,u),J=1,K=0,nt=et=it=tt=$=null},this.setClearColor=function(t,i){Z.copy(t),Q=i,ft.set(-p,-u,p,u)},this.setClearColorHex=function(t,i){Z.setHex(t),Q=i,ft.set(-p,-u,p,u)},this.clear=function(){X.setTransform(1,0,0,-1,p,u),ft.isEmpty()||(ft.minSelf(dt),ft.inflate(2),Q<1&&X.clearRect(Math.floor(ft.getX()),Math.floor(ft.getY()),Math.floor(ft.getWidth()),Math.floor(ft.getHeight())),Q>0&&(e(n.NormalBlending),i(1),o("rgba("+Math.floor(255*Z.r)+","+Math.floor(255*Z.g)+","+Math.floor(255*Z.b)+","+Q+")"),X.fillRect(Math.floor(ft.getX()),Math.floor(ft.getY()),Math.floor(ft.getWidth()),Math.floor(ft.getHeight()))),ft.empty())},this.render=function(t,c){function l(t,i,e,r){var o,s,a,h,c,l;for(o=0,s=t.length;o<s;o++)h=(a=t[o]).color,a instanceof n.DirectionalLight?(c=a.matrixWorld.getPosition(),(l=e.dot(c))<=0||(l*=a.intensity,r.r+=h.r*l,r.g+=h.g*l,r.b+=h.b*l)):a instanceof n.PointLight&&(c=a.matrixWorld.getPosition(),(l=e.dot(wt.sub(c,i).normalize()))<=0||0!=(l*=0==a.distance?1:1-Math.min(i.distanceTo(c)/a.distance,1))&&(l*=a.intensity,r.r+=h.r*l,r.g+=h.g*l,r.b+=h.b*l))}function H(t,s,a){var h,c,l,d,f,m;i(a.opacity),e(a.blending),a instanceof n.ParticleBasicMaterial?a.map&&(f=(d=a.map.image).width>>1,m=d.height>>1,h=(a=s.scale.x*p)*f,c=(l=s.scale.y*u)*m,mt.set(t.x-h,t.y-c,t.x+h,t.y+c),dt.intersects(mt)&&(X.save(),X.translate(t.x,t.y),X.rotate(-s.rotation),X.scale(a,-l),X.translate(-f,-m),X.drawImage(d,0,0),X.restore())):a instanceof n.ParticleCanvasMaterial&&(h=s.scale.x*p,c=s.scale.y*u,mt.set(t.x-h,t.y-c,t.x+h,t.y+c),dt.intersects(mt)&&(r(a.color.getContextStyle()),o(a.color.getContextStyle()),X.save(),X.translate(t.x,t.y),X.rotate(-s.rotation),X.scale(h,c),a.program(X),X.restore()))}function Z(t,o,s,a){i(a.opacity),e(a.blending),X.beginPath(),X.moveTo(t.positionScreen.x,t.positionScreen.y),X.lineTo(o.positionScreen.x,o.positionScreen.y),X.closePath(),a instanceof n.LineBasicMaterial&&(t=a.linewidth,it!=t&&(X.lineWidth=it=t),t=a.linecap,et!=t&&(X.lineCap=et=t),t=a.linejoin,nt!=t&&(X.lineJoin=nt=t),r(a.color.getContextStyle()),X.stroke(),mt.inflate(2*a.linewidth))}function Q(t,r,o,s,a,p,u,d){E.info.render.vertices+=3,E.info.render.faces++,i(d.opacity),e(d.blending),x=t.positionScreen.x,g=t.positionScreen.y,v=r.positionScreen.x,w=r.positionScreen.y,M=o.positionScreen.x,b=o.positionScreen.y,K(x,g,v,w,M,b),d instanceof n.MeshBasicMaterial?d.map?d.map.mapping instanceof n.UVMapping&&(P=u.uvs[0],bt(x,g,v,w,M,b,P[s].u,P[s].v,P[a].u,P[a].v,P[p].u,P[p].v,d.map)):d.envMap?d.envMap.mapping instanceof n.SphericalReflectionMapping&&(t=c.matrixWorldInverse,wt.copy(u.vertexNormalsWorld[s]),B=.5*(wt.x*t.n11+wt.y*t.n12+wt.z*t.n13)+.5,O=.5*-(wt.x*t.n21+wt.y*t.n22+wt.z*t.n23)+.5,wt.copy(u.vertexNormalsWorld[a]),F=.5*(wt.x*t.n11+wt.y*t.n12+wt.z*t.n13)+.5,A=.5*-(wt.x*t.n21+wt.y*t.n22+wt.z*t.n23)+.5,wt.copy(u.vertexNormalsWorld[p]),_=.5*(wt.x*t.n11+wt.y*t.n12+wt.z*t.n13)+.5,D=.5*-(wt.x*t.n21+wt.y*t.n22+wt.z*t.n23)+.5,bt(x,g,v,w,M,b,B,O,F,A,_,D,d.envMap)):d.wireframe?tt(d.color,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(d.color):d instanceof n.MeshLambertMaterial?(d.map&&!d.wireframe&&(d.map.mapping instanceof n.UVMapping&&(P=u.uvs[0],bt(x,g,v,w,M,b,P[s].u,P[s].v,P[a].u,P[a].v,P[p].u,P[p].v,d.map)),e(n.SubtractiveBlending)),yt?d.wireframe||d.shading!=n.SmoothShading||3!=u.vertexNormalsWorld.length?(st.r=xt.r,st.g=xt.g,st.b=xt.b,l(h,u.centroidWorld,u.normalWorld,st),st.r=Math.max(0,Math.min(d.color.r*st.r,1)),st.g=Math.max(0,Math.min(d.color.g*st.g,1)),st.b=Math.max(0,Math.min(d.color.b*st.b,1)),d.wireframe?tt(st,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(st)):(at.r=ht.r=ct.r=xt.r,at.g=ht.g=ct.g=xt.g,at.b=ht.b=ct.b=xt.b,l(h,u.v1.positionWorld,u.vertexNormalsWorld[0],at),l(h,u.v2.positionWorld,u.vertexNormalsWorld[1],ht),l(h,u.v3.positionWorld,u.vertexNormalsWorld[2],ct),at.r=Math.max(0,Math.min(d.color.r*at.r,1)),at.g=Math.max(0,Math.min(d.color.g*at.g,1)),at.b=Math.max(0,Math.min(d.color.b*at.b,1)),ht.r=Math.max(0,Math.min(d.color.r*ht.r,1)),ht.g=Math.max(0,Math.min(d.color.g*ht.g,1)),ht.b=Math.max(0,Math.min(d.color.b*ht.b,1)),ct.r=Math.max(0,Math.min(d.color.r*ct.r,1)),ct.g=Math.max(0,Math.min(d.color.g*ct.g,1)),ct.b=Math.max(0,Math.min(d.color.b*ct.b,1)),lt.r=.5*(ht.r+ct.r),lt.g=.5*(ht.g+ct.g),lt.b=.5*(ht.b+ct.b),T=zt(at,ht,ct,lt),St(x,g,v,w,M,b,0,0,1,0,0,1,T)):d.wireframe?tt(d.color,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(d.color)):d instanceof n.MeshDepthMaterial?(j=c.near,W=c.far,at.r=at.g=at.b=1-Vt(t.positionScreen.z,j,W),ht.r=ht.g=ht.b=1-Vt(r.positionScreen.z,j,W),ct.r=ct.g=ct.b=1-Vt(o.positionScreen.z,j,W),lt.r=.5*(ht.r+ct.r),lt.g=.5*(ht.g+ct.g),lt.b=.5*(ht.b+ct.b),T=zt(at,ht,ct,lt),St(x,g,v,w,M,b,0,0,1,0,0,1,T)):d instanceof n.MeshNormalMaterial&&(st.r=Ct(u.normalWorld.x),st.g=Ct(u.normalWorld.y),st.b=Ct(u.normalWorld.z),d.wireframe?tt(st,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(st))}function J(t,r,o,s,a,p,u,d,f){E.info.render.vertices+=4,E.info.render.faces++,i(d.opacity),e(d.blending),d.map||d.envMap?(Q(t,r,s,0,1,3,u,d),Q(a,o,p,1,2,3,u,d)):(x=t.positionScreen.x,g=t.positionScreen.y,v=r.positionScreen.x,w=r.positionScreen.y,M=o.positionScreen.x,b=o.positionScreen.y,S=s.positionScreen.x,z=s.positionScreen.y,V=a.positionScreen.x,C=a.positionScreen.y,L=p.positionScreen.x,R=p.positionScreen.y,d instanceof n.MeshBasicMaterial?($(x,g,v,w,M,b,S,z),d.wireframe?tt(d.color,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(d.color)):d instanceof n.MeshLambertMaterial?yt?d.wireframe||d.shading!=n.SmoothShading||4!=u.vertexNormalsWorld.length?(st.r=xt.r,st.g=xt.g,st.b=xt.b,l(h,u.centroidWorld,u.normalWorld,st),st.r=Math.max(0,Math.min(d.color.r*st.r,1)),st.g=Math.max(0,Math.min(d.color.g*st.g,1)),st.b=Math.max(0,Math.min(d.color.b*st.b,1)),$(x,g,v,w,M,b,S,z),d.wireframe?tt(st,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(st)):(at.r=ht.r=ct.r=lt.r=xt.r,at.g=ht.g=ct.g=lt.g=xt.g,at.b=ht.b=ct.b=lt.b=xt.b,l(h,u.v1.positionWorld,u.vertexNormalsWorld[0],at),l(h,u.v2.positionWorld,u.vertexNormalsWorld[1],ht),l(h,u.v4.positionWorld,u.vertexNormalsWorld[3],ct),l(h,u.v3.positionWorld,u.vertexNormalsWorld[2],lt),at.r=Math.max(0,Math.min(d.color.r*at.r,1)),at.g=Math.max(0,Math.min(d.color.g*at.g,1)),at.b=Math.max(0,Math.min(d.color.b*at.b,1)),ht.r=Math.max(0,Math.min(d.color.r*ht.r,1)),ht.g=Math.max(0,Math.min(d.color.g*ht.g,1)),ht.b=Math.max(0,Math.min(d.color.b*ht.b,1)),ct.r=Math.max(0,Math.min(d.color.r*ct.r,1)),ct.g=Math.max(0,Math.min(d.color.g*ct.g,1)),ct.b=Math.max(0,Math.min(d.color.b*ct.b,1)),lt.r=Math.max(0,Math.min(d.color.r*lt.r,1)),lt.g=Math.max(0,Math.min(d.color.g*lt.g,1)),lt.b=Math.max(0,Math.min(d.color.b*lt.b,1)),T=zt(at,ht,ct,lt),K(x,g,v,w,S,z),St(x,g,v,w,S,z,0,0,1,0,0,1,T),K(V,C,M,b,L,R),St(V,C,M,b,L,R,1,0,1,1,0,1,T)):($(x,g,v,w,M,b,S,z),d.wireframe?tt(d.color,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(d.color)):d instanceof n.MeshNormalMaterial?(st.r=Ct(u.normalWorld.x),st.g=Ct(u.normalWorld.y),st.b=Ct(u.normalWorld.z),$(x,g,v,w,M,b,S,z),d.wireframe?tt(st,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):Mt(st)):d instanceof n.MeshDepthMaterial&&(j=c.near,W=c.far,at.r=at.g=at.b=1-Vt(t.positionScreen.z,j,W),ht.r=ht.g=ht.b=1-Vt(r.positionScreen.z,j,W),ct.r=ct.g=ct.b=1-Vt(s.positionScreen.z,j,W),lt.r=lt.g=lt.b=1-Vt(o.positionScreen.z,j,W),T=zt(at,ht,ct,lt),K(x,g,v,w,S,z),St(x,g,v,w,S,z,0,0,1,0,0,1,T),K(V,C,M,b,L,R),St(V,C,M,b,L,R,1,0,1,1,0,1,T)))}function K(t,i,e,n,r,o){X.beginPath(),X.moveTo(t,i),X.lineTo(e,n),X.lineTo(r,o),X.lineTo(t,i),X.closePath()}function $(t,i,e,n,r,o,s,a){X.beginPath(),X.moveTo(t,i),X.lineTo(e,n),X.lineTo(r,o),X.lineTo(s,a),X.lineTo(t,i),X.closePath()}function tt(t,i,e,n){it!=i&&(X.lineWidth=it=i),et!=e&&(X.lineCap=et=e),nt!=n&&(X.lineJoin=nt=n),r(t.getContextStyle()),X.stroke(),mt.inflate(2*i)}function Mt(t){o(t.getContextStyle()),X.fill()}function bt(t,i,e,r,s,a,h,c,l,p,u,d,f){if(0!=f.image.width){if(1==f.needsUpdate||null==pt[f.id]){var m=f.wrapS==n.RepeatWrapping,y=f.wrapT==n.RepeatWrapping;pt[f.id]=X.createPattern(f.image,m&&y?"repeat":m&&!y?"repeat-x":!m&&y?"repeat-y":"no-repeat"),f.needsUpdate=!1}o(pt[f.id]);m=f.offset.x/f.repeat.x,y=f.offset.y/f.repeat.y;var x=f.image.width*f.repeat.x,g=f.image.height*f.repeat.y;l=(l+m)*x,p=(p+y)*g,u=(u+m)*x,d=(d+y)*g;e-=t,r-=i,s-=t,a-=i,0==(m=(l-=h=(h+m)*x)*(d-=c=(c+y)*g)-(u-=h)*(p-=c))?(null==ut[f.id]&&((i=document.createElement("canvas")).width=f.image.width,i.height=f.image.height,(t=i.getContext("2d")).drawImage(f.image,0,0),ut[f.id]=t.getImageData(0,0,f.image.width,f.image.height).data,delete i),i=ut[f.id],h=4*(Math.floor(h)+Math.floor(c)*f.image.width),st.setRGB(i[h]/255,i[h+1]/255,i[h+2]/255),Mt(st)):(t=t-(f=(d*e-p*s)*(m=1/m))*h-(e=(l*s-u*e)*m)*c,h=i-(p=(d*r-p*a)*m)*h-(r=(l*a-u*r)*m)*c,X.save(),X.transform(f,p,e,r,t,h),X.fill(),X.restore())}}function St(t,i,e,n,r,o,s,a,h,c,l,p,u){var d,f;h*=d=u.width-1,c*=f=u.height-1,l*=d,p*=f,t=t-(d=((p-=a*=f)*(e-=t)-(c-=a)*(r-=t))*(f=1/((h-=s*=d)*p-(l-=s)*c)))*s-(e=(h*r-l*e)*f)*a,i=i-(c=(p*(n-=i)-c*(o-=i))*f)*s-(n=(h*o-l*n)*f)*a,X.save(),X.transform(d,c,e,n,t,i),X.clip(),X.drawImage(u,0,0),X.restore()}function zt(t,i,e,n){var r=~~(255*t.r),o=~~(255*t.g),s=(t=~~(255*t.b),~~(255*i.r)),a=~~(255*i.g),h=(i=~~(255*i.b),~~(255*e.r)),c=~~(255*e.g),l=(e=~~(255*e.b),~~(255*n.r)),p=~~(255*n.g);n=~~(255*n.b);return U[0]=r<0?0:r>255?255:r,U[1]=o<0?0:o>255?255:o,U[2]=t<0?0:t>255?255:t,U[4]=s<0?0:s>255?255:s,U[5]=a<0?0:a>255?255:a,U[6]=i<0?0:i>255?255:i,U[8]=h<0?0:h>255?255:h,U[9]=c<0?0:c>255?255:c,U[10]=e<0?0:e>255?255:e,U[12]=l<0?0:l>255?255:l,U[13]=p<0?0:p>255?255:p,U[14]=n<0?0:n>255?255:n,k.putImageData(I,0,0),Y.drawImage(N,0,0),q}function Vt(t,i,e){return(t=(t-i)/(e-i))*t*(3-2*t)}function Ct(t){return(t=.5*(t+1))<0?0:t>1?1:t}function Lt(t,i){var e=i.x-t.x,n=i.y-t.y,r=e*e+n*n;0!=r&&(e*=r=1/Math.sqrt(r),n*=r,i.x+=e,i.y+=n,t.x-=e,t.y-=n)}var Rt,jt,Wt,Tt;for(this.autoClear?this.clear():X.setTransform(1,0,0,-1,p,u),E.info.render.vertices=0,E.info.render.faces=0,s=G.projectScene(t,c,this.sortElements),a=s.elements,h=s.lights,(yt=h.length>0)&&function(t){var i,e,r,o;for(xt.setRGB(0,0,0),gt.setRGB(0,0,0),vt.setRGB(0,0,0),i=0,e=t.length;i<e;i++)o=(r=t[i]).color,r instanceof n.AmbientLight?(xt.r+=o.r,xt.g+=o.g,xt.b+=o.b):r instanceof n.DirectionalLight?(gt.r+=o.r,gt.g+=o.g,gt.b+=o.b):r instanceof n.PointLight&&(vt.r+=o.r,vt.g+=o.g,vt.b+=o.b)}(h),Rt=0,jt=a.length;Rt<jt;Rt++)null!=(Tt=(Tt=(Wt=a[Rt]).material)instanceof n.MeshFaceMaterial?Wt.faceMaterial:Tt)&&0!=Tt.opacity&&(mt.empty(),Wt instanceof n.RenderableParticle?((d=Wt).x*=p,d.y*=u,H(d,Wt,Tt)):Wt instanceof n.RenderableLine?(d=Wt.v1,f=Wt.v2,d.positionScreen.x*=p,d.positionScreen.y*=u,f.positionScreen.x*=p,f.positionScreen.y*=u,mt.addPoint(d.positionScreen.x,d.positionScreen.y),mt.addPoint(f.positionScreen.x,f.positionScreen.y),dt.intersects(mt)&&Z(d,f,0,Tt)):Wt instanceof n.RenderableFace3?(d=Wt.v1,f=Wt.v2,m=Wt.v3,d.positionScreen.x*=p,d.positionScreen.y*=u,f.positionScreen.x*=p,f.positionScreen.y*=u,m.positionScreen.x*=p,m.positionScreen.y*=u,Tt.overdraw&&(Lt(d.positionScreen,f.positionScreen),Lt(f.positionScreen,m.positionScreen),Lt(m.positionScreen,d.positionScreen)),mt.add3Points(d.positionScreen.x,d.positionScreen.y,f.positionScreen.x,f.positionScreen.y,m.positionScreen.x,m.positionScreen.y),dt.intersects(mt)&&Q(d,f,m,0,1,2,Wt,Tt)):Wt instanceof n.RenderableFace4&&(d=Wt.v1,f=Wt.v2,m=Wt.v3,y=Wt.v4,d.positionScreen.x*=p,d.positionScreen.y*=u,f.positionScreen.x*=p,f.positionScreen.y*=u,m.positionScreen.x*=p,m.positionScreen.y*=u,y.positionScreen.x*=p,y.positionScreen.y*=u,rt.positionScreen.copy(f.positionScreen),ot.positionScreen.copy(y.positionScreen),Tt.overdraw&&(Lt(d.positionScreen,f.positionScreen),Lt(f.positionScreen,y.positionScreen),Lt(y.positionScreen,d.positionScreen),Lt(m.positionScreen,rt.positionScreen),Lt(m.positionScreen,ot.positionScreen)),mt.addPoint(d.positionScreen.x,d.positionScreen.y),mt.addPoint(f.positionScreen.x,f.positionScreen.y),mt.addPoint(m.positionScreen.x,m.positionScreen.y),mt.addPoint(y.positionScreen.x,y.positionScreen.y),dt.intersects(mt)&&J(d,f,m,y,rt,ot,Wt,Tt)),ft.addRectangle(mt));X.setTransform(1,0,0,1,0,0)}},n.RenderableVertex=function(){this.positionWorld=new n.Vector3,this.positionScreen=new n.Vector4,this.visible=!0},n.RenderableVertex.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)},n.RenderableFace3=function(){this.v1=new n.RenderableVertex,this.v2=new n.RenderableVertex,this.v3=new n.RenderableVertex,this.centroidWorld=new n.Vector3,this.centroidScreen=new n.Vector3,this.normalWorld=new n.Vector3,this.vertexNormalsWorld=[new n.Vector3,new n.Vector3,new n.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},n.RenderableFace4=function(){this.v1=new n.RenderableVertex,this.v2=new n.RenderableVertex,this.v3=new n.RenderableVertex,this.v4=new n.RenderableVertex,this.centroidWorld=new n.Vector3,this.centroidScreen=new n.Vector3,this.normalWorld=new n.Vector3,this.vertexNormalsWorld=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},n.RenderableObject=function(){this.z=this.object=null},n.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new n.Vector2,this.material=null},n.RenderableLine=function(){this.z=null,this.v1=new n.RenderableVertex,this.v2=new n.RenderableVertex,this.material=null},e.exports=n}));